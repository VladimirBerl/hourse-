# Manezh.pro Backend

Этот репозиторий содержит бэкенд для приложения Manezh.pro. Он построен на Node.js, Express, TypeScript и использует Prisma для взаимодействия с базой данных MySQL.

## Установка и запуск

### Требования

- Node.js (v18+)
- MySQL

### 1. Установка зависимостей

Перейдите в папку `backend` и выполните команду:

```bash
npm install
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корне папки `backend` по следующему шаблону:

```env
DATABASE_URL="mysql://USER:PASSWORD@HOST:PORT/DATABASE_NAME"
JWT_SECRET="your-super-secret-jwt-key"
PORT=3001
```

- `DATABASE_URL`: Строка подключения к вашей базе данных MySQL.
- `JWT_SECRET`: Секретный ключ для подписи JWT токенов.
- `PORT`: Порт, на котором будет запущен сервер.

### 3. Миграции базы данных

После настройки `.env` примените схему данных к вашей базе данных с помощью Prisma:

```bash
npx prisma migrate dev
```

Эта команда создаст таблицы в вашей БД в соответствии со схемой в `prisma/schema.prisma`.

### 4. Запуск в режиме разработки

Для запуска сервера с автоматической перезагрузкой при изменениях в коде:

```bash
npm run dev
```

Сервер будет доступен по адресу `http://localhost:3001` (или на порту, указанном в `.env`).

### 5. Сборка для продакшена

Для компиляции TypeScript в JavaScript (в папку `dist`):

```bash
npm run build
```

### 6. Запуск в продакшене

Для запуска скомпилированного приложения:

```bash
npm start
```

## Развертывание на reg.ru

1.  **Создание приложения**: В панели управления хостинга Reg.ru перейдите в раздел "Сайты" -> "Node.js" и создайте новое приложение.

2.  **Загрузка файлов**: Загрузите все файлы из папки `backend` на сервер в корневую директорию вашего Node.js-приложения (обычно через FTP или Git). **Важно: не загружайте на сервер файл `.env` и папку `node_modules`.**

3.  **Настройка приложения**:
    - В настройках приложения в панели Reg.ru найдите поле **"Application startup file"** (Файл запуска приложения).
    - Укажите в нем путь: `dist/index.js`.

4.  **Переменные окружения**:
    - Перейдите в раздел "Переменные окружения" в настройках вашего приложения на хостинге.
    - Создайте следующие переменные:
        - `DATABASE_URL`: Укажите полную строку подключения к вашей базе данных MySQL, созданной на хостинге.
        - `JWT_SECRET`: Введите длинную, случайную и надежную строку для безопасности.
        - `PORT`: Reg.ru обычно предоставляет эту переменную автоматически. Если нет, уточните в поддержке, нужно ли ее задавать вручную.

5.  **Установка и сборка на сервере**:
    - Подключитесь к вашему серверу по SSH.
    - Перейдите в корневую директорию вашего приложения.
    - Выполните команды для установки зависимостей и сборки проекта:
      ```bash
      npm install
      npm run build
      ```

6.  **Запуск**:
    - Вернитесь в панель управления Reg.ru.
    - Нажмите кнопку "Перезапустить" или "Запустить" для вашего приложения. Это действие выполнит команду, которую вы указали в `package.json` как `start` (`node dist/index.js`).
    - Проверьте логи приложения в панели управления, чтобы убедиться, что сервер запустился без ошибок.
